"use strict";(self.webpackChunk_memenashi_react_qr_reader=self.webpackChunk_memenashi_react_qr_reader||[]).push([[847],{"./src/components/QrReader.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ScanCode:()=>ScanCode,__namedExportsOrder:()=>__namedExportsOrder,default:()=>QrReader_stories});var react=__webpack_require__("./node_modules/react/index.js"),dist=__webpack_require__("./node_modules/@storybook/addon-actions/dist/index.mjs"),ViewFinder=__webpack_require__("./src/components/ViewFinder.tsx");const styles_container={width:"100%",paddingTop:"100%",overflow:"hidden",position:"relative"},styles_video={top:0,left:0,width:"100%",height:"100%",display:"block",overflow:"hidden",position:"absolute",transform:void 0,objectFit:"cover"};var esm=__webpack_require__("./node_modules/@zxing/browser/esm/index.js");const useQrReader=({scanDelay=200,onResult,onError})=>{const videoRef=(0,react.useRef)(null),previousScan=(0,react.useRef)(),previousError=(0,react.useRef)(),qrReader=(0,react.useRef)(null),qrControl=(0,react.useRef)(void 0),scanCallback=(0,react.useCallback)((async(result,error,control)=>{const resultText=null==result?void 0:result.getText(),previousScanText=previousScan.current;return resultText&&resultText!=previousScanText?(previousScan.current=resultText,null==onResult?void 0:onResult(result,control)):error&&error!=previousError.current?(previousError.current=error,null==onError?void 0:onError(error,control)):void 0}),[onError,onResult]),resetScanResult=(0,react.useCallback)((()=>{previousScan.current=null,previousError.current=void 0}),[]),startScanner=(0,react.useCallback)((async()=>{var ms;if(null!=videoRef.current)try{var _qrReader$current;return ms=scanDelay,new Promise((resolve=>setTimeout(resolve,ms))),null===(_qrReader$current=qrReader.current)||void 0===_qrReader$current?void 0:_qrReader$current.decodeFromVideoDevice(void 0,videoRef.current,scanCallback)}catch(e){e instanceof Error&&(null==onError||onError(e))}}),[scanDelay,scanCallback,onError]);return(0,react.useEffect)((()=>{if(!(()=>{const isMediaDevicesSupported="undefined"!=typeof navigator&&!!navigator.mediaDevices;return isMediaDevicesSupported||console.warn('[ReactQrReader]: MediaDevices API has no support for your browser. You can fix this by running "npm i webrtc-adapter"'),isMediaDevicesSupported})()&&((value,name,type)=>{const isValid=typeof value===type;return isValid||console.warn(`[ReactQrReader]: Expected "${name}" to be a of type "${type}".`),isValid})(onResult,"onResult","function")){null==onError||onError(new Error('MediaDevices API has no support for your browser. You can fix this by running "npm i webrtc-adapter"'))}return qrReader.current||(qrReader.current=new esm.Nm(void 0,{delayBetweenScanAttempts:scanDelay,delayBetweenScanSuccess:scanDelay})),startScanner().then((ctrl=>{qrControl.current=ctrl})),()=>{var _qrControl$current;null===(_qrControl$current=qrControl.current)||void 0===_qrControl$current||_qrControl$current.stop()}}),[scanDelay,onError,onResult,startScanner]),{videoRef,resetScanResult}};var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const QrReader=({videoContainerStyle={},containerStyle,videoStyle,ViewFinder,scanDelay,className,onResult,onError,videoId})=>{const{videoRef,resetScanResult}=useQrReader({scanDelay,onResult,onError,videoId});return(0,react.useEffect)((()=>{resetScanResult()}),[resetScanResult]),(0,jsx_runtime.jsx)("section",{className,style:containerStyle,children:(0,jsx_runtime.jsxs)("div",{style:{...styles_container,...videoContainerStyle},children:[!!ViewFinder&&(0,jsx_runtime.jsx)(ViewFinder,{}),(0,jsx_runtime.jsx)("video",{muted:!0,id:videoId,ref:videoRef,style:{...styles_video,...videoStyle}})]})})};QrReader.displayName="QrReader",QrReader.displayName="QrReader",QrReader.defaultProps={videoId:"video",scanDelay:500};try{QrReader.displayName="QrReader",QrReader.__docgenInfo={description:"",displayName:"QrReader",props:{defaultDeviceIdIndex:{defaultValue:null,description:"",name:"defaultDeviceIdIndex",required:!1,type:{name:"enum",value:[{value:"0"},{value:"1"}]}},onResult:{defaultValue:null,description:"Called when a result is found.",name:"onResult",required:!1,type:{name:"OnResultFunction"}},onError:{defaultValue:null,description:"Called when an error occurs.",name:"onError",required:!1,type:{name:"OnErrorFunction"}},ViewFinder:{defaultValue:null,description:"Property that represents the view finder component",name:"ViewFinder",required:!1,type:{name:"FC"}},scanDelay:{defaultValue:{value:"500"},description:"Property that represents the scan period",name:"scanDelay",required:!1,type:{name:"number"}},videoId:{defaultValue:{value:"video"},description:"Property that represents the ID of the video element",name:"videoId",required:!1,type:{name:"string"}},className:{defaultValue:null,description:"Property that represents an optional className to modify styles",name:"className",required:!1,type:{name:"string"}},containerStyle:{defaultValue:null,description:"Property that represents a style for the container",name:"containerStyle",required:!1,type:{name:"CSSProperties"}},videoContainerStyle:{defaultValue:{value:"{}"},description:"Property that represents a style for the video container",name:"videoContainerStyle",required:!1,type:{name:"CSSProperties"}},videoStyle:{defaultValue:null,description:"Property that represents a style for the video",name:"videoStyle",required:!1,type:{name:"CSSProperties"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/QrReader.tsx#QrReader"]={docgenInfo:QrReader.__docgenInfo,name:"QrReader",path:"src/components/QrReader.tsx#QrReader"})}catch(__react_docgen_typescript_loader_error){}var _ScanCode$parameters,_ScanCode$parameters2,_ScanCode$parameters3;const QrReader_stories_styles={container:{width:"100vw",maxWidth:"300px",margin:"auto"}},scanAction=(0,dist.aD)("handleScan"),Template=args=>{const[error,setError]=(0,react.useState)(""),[data,setData]=(0,react.useState)("");return(0,jsx_runtime.jsxs)("div",{style:QrReader_stories_styles.container,children:[(0,jsx_runtime.jsx)(QrReader,{...args,onResult:async result=>{scanAction(result),setData((null==result?void 0:result.getText())??"No result")},onError:err=>setError((null==err?void 0:err.message)??"")}),(0,jsx_runtime.jsxs)("p",{children:["The value is: ",JSON.stringify(data,null,2)]}),(0,jsx_runtime.jsxs)("p",{children:["The error is: ",error]})]})};Template.displayName="Template";const ScanCode=Template.bind({});ScanCode.args={ViewFinder:ViewFinder.q,scanDelay:500};const QrReader_stories={title:"Browser QR Reader",component:QrReader};ScanCode.parameters={...ScanCode.parameters,docs:{...null===(_ScanCode$parameters=ScanCode.parameters)||void 0===_ScanCode$parameters?void 0:_ScanCode$parameters.docs,source:{originalSource:"args => {\n  const [error, setError] = useState('');\n  const [data, setData] = useState('');\n  const handleScan: OnResultFunction = async result => {\n    scanAction(result);\n    setData(result?.getText() ?? 'No result');\n  };\n  return <div style={styles.container}>\n      <QrReader {...args} onResult={handleScan} onError={err => setError(err?.message ?? '')} />\n      <p>The value is: {JSON.stringify(data, null, 2)}</p>\n      <p>The error is: {error}</p>\n    </div>;\n}",...null===(_ScanCode$parameters2=ScanCode.parameters)||void 0===_ScanCode$parameters2||null===(_ScanCode$parameters3=_ScanCode$parameters2.docs)||void 0===_ScanCode$parameters3?void 0:_ScanCode$parameters3.source}}};const __namedExportsOrder=["ScanCode"]},"./src/components/ViewFinder.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{q:()=>ViewFinder});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/jsx-runtime.js");const ViewFinder=()=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment,{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("svg",{width:"50px",viewBox:"0 0 100 100",style:{top:0,left:0,zIndex:1,boxSizing:"border-box",border:"50px solid rgba(0, 0, 0, 0.3)",position:"absolute",width:"100%",height:"100%"},children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("path",{fill:"none",d:"M13,0 L0,0 L0,13",stroke:"rgba(255, 0, 0, 0.5)",strokeWidth:"5"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("path",{fill:"none",d:"M0,87 L0,100 L13,100",stroke:"rgba(255, 0, 0, 0.5)",strokeWidth:"5"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("path",{fill:"none",d:"M87,100 L100,100 L100,87",stroke:"rgba(255, 0, 0, 0.5)",strokeWidth:"5"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("path",{fill:"none",d:"M100,13 L100,0 87,0",stroke:"rgba(255, 0, 0, 0.5)",strokeWidth:"5"})]})})}}]);